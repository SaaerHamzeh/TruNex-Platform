{% load static %}
<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <title>
      {% if news_source %}
        ØªØ¹Ø¯ÙŠÙ„
      {% else %}
        Ø¥Ø¶Ø§ÙØ©
      {% endif %}Ù…ØµØ¯Ø±
    </title>
    <link rel="stylesheet" href="{% static 'css/news_source_form.css' %}" />
  </head>
  <body>
    <div class="form-container">
      <h2 style="text-align: center; color: #2980b9; margin-bottom: 30px;">
        {% if news_source %}
          ØªØ¹Ø¯ÙŠÙ„
        {% else %}
          Ø¥Ø¶Ø§ÙØ©
        {% endif %}Ù…ØµØ¯Ø± ğŸ“°
      </h2>
      <form method="POST">
        {% csrf_token %}

        <div class="form-group">
          <label>news source & name</label>
          <div class="split-inputs">
            <input type="text" placeholder="NAME" name="name" value="{{ news_source.news_source_name|default:'' }}" required />
            <input type="text" placeholder="URL" name="url" value="{{ news_source.news_source_url|default:'' }}" required />
          </div>
        </div>

        <div class="form-group">
          <label>âš™ï¸ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¬Ù„Ø¨ ÙˆØ§Ù„Ù„ØºØ©:</label>
          <div class="split-inputs">
            <select name="fetch_method" required data-selected="{{ news_source.news_source_method|default:'api' }}">
              <option value="api">API</option>
              <option value="rss">RSS</option>
              <option value="scraper">Scraper</option>
            </select>

            <select name="fetch_language" required data-selected="{{ news_source.news_source_language|default:'en' }}">
              <option value="en">Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
              <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>â±ï¸ Ø§Ù„ÙØ§ØµÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª:</label>
          <div class="split-inputs">
            <input type="number" name="fetch_interval" min="1" value="{{ news_source.fetch_interval_minutes|default:60 }}" />
            <input type="number" name="fetch_limit" min="1" value="{{ news_source.fetch_limit|default:10 }}" />
          </div>
        </div>

        <div class="form-group">
          <label>ğŸŒ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ÙØ±Ø¹ÙŠØ©:</label>
          <div id="sections-wrapper">
            {% if news_source and news_source.section_urls.all %}
              {% for section in news_source.section_urls.all %}
                <div class="section-group">
                  <input type="text" name="section_url" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ø³Ù…" value="{{ section.section_url }}" />
                  <input type="text" name="section_type" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø³Ù…" value="{{ section.section_type }}" />
                  <select name="section_region" data-selected="{{ section.section_region|default:'' }}">
                    <option value="">Ø¨Ø¯ÙˆÙ† Ù†Ø·Ø§Ù‚</option>
                    <option value="syria">Syria</option>
                    <option value="arab">Arab</option>
                    <option value="world">World</option>
                  </select>
                  <button type="button" class="remove-section-btn" onclick="removeSection(this)">-</button>
                </div>
              {% endfor %}
            {% else %}
              <div class="section-group">
                <input type="text" name="section_url" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ø³Ù…" />
                <input type="text" name="section_type" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø³Ù…" />
                <select name="section_region">
                  <option value="">Ø¨Ø¯ÙˆÙ† Ù†Ø·Ø§Ù‚</option>
                  <option value="syria">Syria</option>
                  <option value="arab">Arab</option>
                  <option value="world">World</option>
                </select>
                <button type="button" class="remove-section-btn" onclick="removeSection(this)">-</button>
              </div>
            {% endif %}
          </div>
          <button type="button" class="add-section-btn" onclick="addSection()">+ Ø£Ø¶Ù Ø±Ø§Ø¨Ø· ÙØ±Ø¹ÙŠ</button>
        </div>

        <button type="submit">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…ØµØ¯Ø±</button>
      </form>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ data-selected
        document.querySelectorAll('select').forEach((select) => {
          const selected = select.getAttribute('data-selected')
          if (selected) {
            select.value = selected
          }
        })
      })
    </script>

    <script>
      function addSection() {
        const wrapper = document.getElementById('sections-wrapper')
        const div = document.createElement('div')
        div.className = 'section-group'
        div.innerHTML = `
                      <input type="text" name="section_url" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ø³Ù…">
                      <input type="text" name="section_type" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø³Ù…">
                      <select name="section_region">
                        <option value="">Ø¨Ø¯ÙˆÙ† Ù†Ø·Ø§Ù‚</option>
                        <option value="syria">Syria</option>
                        <option value="arab">Arab</option>
                        <option value="world">World</option>
                      </select>
                      <button type="button" class="remove-section-btn" onclick="removeSection(this)">-</button>
                    `
        wrapper.appendChild(div)
      }
      
      function removeSection(button) {
        button.parentElement.remove()
      }
    </script>
  </body>
</html>
